{"version":3,"file":"KHR_lights_punctual-CSIWTc6b.js","sources":["../../node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_lights_punctual.js"],"sourcesContent":["import { Vector3 } from \"@babylonjs/core/Maths/math.vector.js\";\nimport { Color3 } from \"@babylonjs/core/Maths/math.color.js\";\nimport { DirectionalLight } from \"@babylonjs/core/Lights/directionalLight.js\";\nimport { PointLight } from \"@babylonjs/core/Lights/pointLight.js\";\nimport { SpotLight } from \"@babylonjs/core/Lights/spotLight.js\";\nimport { Light } from \"@babylonjs/core/Lights/light.js\";\nimport { GLTFLoader, ArrayItem } from \"../glTFLoader.js\";\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry.js\";\nconst NAME = \"KHR_lights_punctual\";\n/**\n * [Specification](https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_lights_punctual/README.md)\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class KHR_lights {\n    /**\n     * @internal\n     */\n    constructor(loader) {\n        /**\n         * The name of this extension.\n         */\n        this.name = NAME;\n        this._loader = loader;\n        this.enabled = this._loader.isExtensionUsed(NAME);\n    }\n    /** @internal */\n    dispose() {\n        this._loader = null;\n        delete this._lights;\n    }\n    /** @internal */\n    onLoading() {\n        const extensions = this._loader.gltf.extensions;\n        if (extensions && extensions[this.name]) {\n            const extension = extensions[this.name];\n            this._lights = extension.lights;\n            ArrayItem.Assign(this._lights);\n        }\n    }\n    /**\n     * @internal\n     */\n    loadNodeAsync(context, node, assign) {\n        return GLTFLoader.LoadExtensionAsync(context, node, this.name, (extensionContext, extension) => {\n            this._loader._allMaterialsDirtyRequired = true;\n            return this._loader.loadNodeAsync(context, node, (babylonMesh) => {\n                let babylonLight;\n                const light = ArrayItem.Get(extensionContext, this._lights, extension.light);\n                const name = light.name || babylonMesh.name;\n                this._loader.babylonScene._blockEntityCollection = !!this._loader._assetContainer;\n                switch (light.type) {\n                    case \"directional\" /* KHRLightsPunctual_LightType.DIRECTIONAL */: {\n                        const babylonDirectionalLight = new DirectionalLight(name, Vector3.Backward(), this._loader.babylonScene);\n                        babylonDirectionalLight.position.setAll(0);\n                        babylonLight = babylonDirectionalLight;\n                        break;\n                    }\n                    case \"point\" /* KHRLightsPunctual_LightType.POINT */: {\n                        babylonLight = new PointLight(name, Vector3.Zero(), this._loader.babylonScene);\n                        break;\n                    }\n                    case \"spot\" /* KHRLightsPunctual_LightType.SPOT */: {\n                        const babylonSpotLight = new SpotLight(name, Vector3.Zero(), Vector3.Backward(), 0, 1, this._loader.babylonScene);\n                        babylonSpotLight.angle = ((light.spot && light.spot.outerConeAngle) || Math.PI / 4) * 2;\n                        babylonSpotLight.innerAngle = ((light.spot && light.spot.innerConeAngle) || 0) * 2;\n                        babylonLight = babylonSpotLight;\n                        break;\n                    }\n                    default: {\n                        this._loader.babylonScene._blockEntityCollection = false;\n                        throw new Error(`${extensionContext}: Invalid light type (${light.type})`);\n                    }\n                }\n                babylonLight._parentContainer = this._loader._assetContainer;\n                this._loader.babylonScene._blockEntityCollection = false;\n                light._babylonLight = babylonLight;\n                babylonLight.falloffType = Light.FALLOFF_GLTF;\n                babylonLight.diffuse = light.color ? Color3.FromArray(light.color) : Color3.White();\n                babylonLight.intensity = light.intensity == undefined ? 1 : light.intensity;\n                babylonLight.range = light.range == undefined ? Number.MAX_VALUE : light.range;\n                babylonLight.parent = babylonMesh;\n                this._loader._babylonLights.push(babylonLight);\n                GLTFLoader.AddPointerMetadata(babylonLight, extensionContext);\n                assign(babylonMesh);\n            });\n        });\n    }\n}\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new KHR_lights(loader));\n//# sourceMappingURL=KHR_lights_punctual.js.map"],"names":["NAME","KHR_lights","loader","extensions","extension","ArrayItem","context","node","assign","GLTFLoader","extensionContext","babylonMesh","babylonLight","light","name","babylonDirectionalLight","DirectionalLight","Vector3","PointLight","babylonSpotLight","SpotLight","Light","Color3","unregisterGLTFExtension","registerGLTFExtension"],"mappings":"4LAQA,MAAMA,EAAO,sBAKN,MAAMC,CAAW,CAIpB,YAAYC,EAAQ,CAIhB,KAAK,KAAOF,EACZ,KAAK,QAAUE,EACf,KAAK,QAAU,KAAK,QAAQ,gBAAgBF,CAAI,CACxD,CAEI,SAAU,CACN,KAAK,QAAU,KACf,OAAO,KAAK,OACpB,CAEI,WAAY,CACR,MAAMG,EAAa,KAAK,QAAQ,KAAK,WACrC,GAAIA,GAAcA,EAAW,KAAK,IAAI,EAAG,CACrC,MAAMC,EAAYD,EAAW,KAAK,IAAI,EACtC,KAAK,QAAUC,EAAU,OACzBC,EAAU,OAAO,KAAK,OAAO,CACzC,CACA,CAII,cAAcC,EAASC,EAAMC,EAAQ,CACjC,OAAOC,EAAW,mBAAmBH,EAASC,EAAM,KAAK,KAAM,CAACG,EAAkBN,KAC9E,KAAK,QAAQ,2BAA6B,GACnC,KAAK,QAAQ,cAAcE,EAASC,EAAOI,GAAgB,CAC9D,IAAIC,EACJ,MAAMC,EAAQR,EAAU,IAAIK,EAAkB,KAAK,QAASN,EAAU,KAAK,EACrEU,EAAOD,EAAM,MAAQF,EAAY,KAEvC,OADA,KAAK,QAAQ,aAAa,uBAAyB,CAAC,CAAC,KAAK,QAAQ,gBAC1DE,EAAM,KAAI,CACd,IAAK,cAA6D,CAC9D,MAAME,EAA0B,IAAIC,EAAiBF,EAAMG,EAAQ,WAAY,KAAK,QAAQ,YAAY,EACxGF,EAAwB,SAAS,OAAO,CAAC,EACzCH,EAAeG,EACf,KACxB,CACoB,IAAK,QAAiD,CAClDH,EAAe,IAAIM,EAAWJ,EAAMG,EAAQ,OAAQ,KAAK,QAAQ,YAAY,EAC7E,KACxB,CACoB,IAAK,OAA+C,CAChD,MAAME,EAAmB,IAAIC,EAAUN,EAAMG,EAAQ,KAAM,EAAEA,EAAQ,SAAQ,EAAI,EAAG,EAAG,KAAK,QAAQ,YAAY,EAChHE,EAAiB,OAAUN,EAAM,MAAQA,EAAM,KAAK,gBAAmB,KAAK,GAAK,GAAK,EACtFM,EAAiB,YAAeN,EAAM,MAAQA,EAAM,KAAK,gBAAmB,GAAK,EACjFD,EAAeO,EACf,KACxB,CACoB,QACI,WAAK,QAAQ,aAAa,uBAAyB,GAC7C,IAAI,MAAM,GAAGT,CAAgB,yBAAyBG,EAAM,IAAI,GAAG,CAEjG,CACgBD,EAAa,iBAAmB,KAAK,QAAQ,gBAC7C,KAAK,QAAQ,aAAa,uBAAyB,GACnDC,EAAM,cAAgBD,EACtBA,EAAa,YAAcS,EAAM,aACjCT,EAAa,QAAUC,EAAM,MAAQS,EAAO,UAAUT,EAAM,KAAK,EAAIS,EAAO,MAAO,EACnFV,EAAa,UAAYC,EAAM,WAAa,KAAY,EAAIA,EAAM,UAClED,EAAa,MAAQC,EAAM,OAAS,KAAY,OAAO,UAAYA,EAAM,MACzED,EAAa,OAASD,EACtB,KAAK,QAAQ,eAAe,KAAKC,CAAY,EAC7CH,EAAW,mBAAmBG,EAAcF,CAAgB,EAC5DF,EAAOG,CAAW,CAClC,CAAa,EACJ,CACT,CACA,CACAY,EAAwBvB,CAAI,EAC5BwB,EAAsBxB,EAAM,GAAOE,GAAW,IAAID,EAAWC,CAAM,CAAC","x_google_ignoreList":[0]}